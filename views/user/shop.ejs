


<%- include("../../views/layout/user/header",{user:user}) %>	

		<head>
			<style>
		
		.filter-and-sort-section {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 15px;
  background-color: #f9f9f9;
  padding: 10px 20px;
  border: 1px solid #ddd;
  border-radius: 5px;
  width: 100%;
}

.filter-section {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
  width: 100%;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 5px;
}

.filter-group label {
  font-size: 0.85rem;
  white-space: nowrap;
}

.filter-group select,
.filter-group input {
  font-size: 0.85rem;
  padding: 5px;
}

.price-inputs {
  display: flex;
  gap: 5px;
}

.small-input {
  width: 70px;
}

.apply-btn {
  padding: 6px 10px;
  font-size: 0.85rem;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* Responsive Styling */
@media (max-width: 768px) {
  .filter-and-sort-section {
    flex-direction: column;
    align-items: flex-start;
  }
  .filter-section {
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
  }
  .filter-group {
    width: 100%;
  }
  .price-inputs {
    width: 100%;
  }
  .small-input {
    width: 48%;
  }
  .apply-btn {
    width: 100%;
    text-align: center;
  }
}




			</style>
		</head>
		

		<!-- Page item Area -->
		<div id="page_item_area">
			<div class="container">
				<div class="row">
					<div class="col-sm-6 text-left">
						<h3>Shop</h3>
					</div>		

					<div class="col-sm-6 text-right">
						<ul class="p_items">
							<li><a href="/">home</a></li>
							<li><span>Shop</span></li>
						</ul>					
					</div>	

				</div>
			</div>
		</div>
		
		
		<!-- Shop Product Area -->
		<div class="shop_page_area">
			<div class="container">
				<div class="shop_bar_tp fix">
					<div class="filter-and-sort-section">
						<div class="filter-section">
						  <h3>Filter & Sort</h3>
						  <!-- Filter Section -->
						  <div class="filter-group">
							<label for="category">Category</label>
							<select id="category">
							  <option value="">All Categories</option>
							  <% categories.forEach(category => { %>
								<option value="<%= category._id %>"><%= category.name %></option>
							  <% }) %>
							</select>
						  </div>
						  <div class="filter-group">
							<label for="price-range">Price Range</label>
							<div class="price-inputs">
								<input type="number" id="min-price" placeholder="Min" class="small-input" min="0" step="0.01">
								<span id="min-price-error" class="error-message"></span> <!-- Error message for min-price -->
							
								<input type="number" id="max-price" placeholder="Max" class="small-input" min="0" step="0.01">
								<span id="max-price-error" class="error-message"></span> <!-- Error message for max-price -->
							</div>
							
							
						  </div>
						  <div class="filter-group">
							<label for="rating">Rating</label>
							<select id="rating">
							  <option value="">All Ratings</option>
							  <option value="5">5 stars</option>
							  <option value="4">4 stars & up</option>
							  <option value="3">3 stars & up</option>
							  <option value="2">2 stars & up</option>
							  <option value="1">1 star & up</option>
							</select>
						  </div>
					  
						  <!-- Sort Section -->
						  <div class="filter-group">
							<label for="sort-select">Sort By</label>
							<select class="sort-select" id="sort-select">
							  <option value="popularity">Popularity</option>
							  <option value="priceLowToHigh">Price: Low to High</option>
							  <option value="priceHighToLow">Price: High to Low</option>
							  <option value="averageRating">Average Ratings</option>
							  <option value="newArrivals">New Arrivals</option>
							  <option value="nameAsc">A-Z</option>
							  <option value="nameDesc">Z-A</option>
							</select>
						  </div>
						  <div class="filter-group">
							<label for="show-select">Show</label>
							<select class="show-select">
							  <option>8</option>
							  <option>12</option>
							  <option>30</option>
							  <option>ALL</option>
							</select>
						  </div>
					  
						  <!-- Apply Button -->
						  <button class="apply-btn" onclick="applyFilters()">Apply</button>
						</div>
					  </div>
					  
				</div>
					
				<div class="shop_details text-center">
					<div class="row">		
						
						



						<% products.forEach(product => { %>
							<div class="col-lg-3 col-md-4 col-sm-6">
								<div class="product-grid">
									<div class="product-image">
										<a href="/productDetails/<%=product._id%>">
											<!-- <img class="pic-1" src="img/product/1.jpg" alt="product image">
											<img class="pic-2" src="img/product/2.jpg" alt="product image"> -->
											<img class="pic-1" src="/uploads/re-image/<%= product.productImage[0] %>" alt="product image 1">
																		<% if (product.productImage[1]) { %>
																				<img class="pic-2" src="/uploads/re-image/<%= product.productImage[1] %>" alt="product image 2">
																		<% } %>
										</a>
										<ul class="social">
											<li><a href="#" data-tip="Quick View"><i class="ti-zoom-in"></i></a></li>
											<li><a href="#" data-tip="Add to Wishlist"><i class="ti-bag"></i></a></li>
											<li><a href="#" data-tip="Add to Cart"><i class="ti-shopping-cart"></i></a></li>
										</ul>
										<!-- <span class="product-new-label">Sale</span> -->
										<% if (product.isOnSale) { %>
											<span class="product-new-label">Sale</span>
									<% } %>
									</div>
									<ul class="rating">
										<li class="fa fa-star"></li>
										<li class="fa fa-star"></li>
										<li class="fa fa-star"></li>
										<li class="fa fa-star"></li>
										<li class="fa fa-star"></li>
									</ul>
									<div class="product-content">
										<h3 class="title"><a href="/productDetails/<%= product._id %>"><%= product.productName %></a></h3>
										<div class="price">Rs<%= product.salePrice %>
											<% if (product.regularPrice) { %>
													<span>Rs<%= product.regularPrice %></span>
											<% } %>
									</div>
										<a class="add-to-cart" href="#">+ Add To Cart</a>
									</div>
								</div>
							</div>
							
							<!-- End Col -->
							<% }) %>



						
						
													
					</div>
				</div> 
					
				
				<div class="col-xs-12">
					<div class="blog_pagination pgntn_mrgntp fix">
					  <div class="pagination text-center">
						<ul>
						  <!-- Previous Page Button -->
						  <% if (currentPage > 1) { %>
							<li><a href="?page=<%= currentPage - 1 %>&limit=<%= limit %>&category=<%= query.category %>&minPrice=<%= query.minPrice %>&maxPrice=<%= query.maxPrice %>&rating=<%= query.rating %>&sort=<%= query.sort %>"><i class="fa fa-angle-left"></i></a></li>
						  <% } else { %>
							<li class="disabled"><a href="#"><i class="fa fa-angle-left"></i></a></li>
						  <% } %>
				  
						  <!-- Page Numbers -->
						  <% for (let i = 1; i <= totalPages; i++) { %>
							<li>
							  <a href="?page=<%= i %>&limit=<%= limit %>&category=<%= query.category %>&minPrice=<%= query.minPrice %>&maxPrice=<%= query.maxPrice %>&rating=<%= query.rating %>&sort=<%= query.sort %>"
								 class="<%= currentPage === i ? 'active' : '' %>">
								<%= i %>
							  </a>
							</li>
						  <% } %>
				  
						  <!-- Next Page Button -->
						  <% if (currentPage < totalPages) { %>
							<li><a href="?page=<%= currentPage + 1 %>&limit=<%= limit %>&category=<%= query.category %>&minPrice=<%= query.minPrice %>&maxPrice=<%= query.maxPrice %>&rating=<%= query.rating %>&sort=<%= query.sort %>"><i class="fa fa-angle-right"></i></a></li>
						  <% } else { %>
							<li class="disabled"><a href="#"><i class="fa fa-angle-right"></i></a></li>
						  <% } %>
						</ul>
					  </div>
					</div>
				  </div>
				  
				  





			</div>
		</div>

		<%- include("../../views/layout/user/footer") %>

		<script>
			function applyFilters() {
  const category = document.getElementById('category').value;
  const maxPrice = document.getElementById('max-price').value;
  const minPrice = document.getElementById('min-price').value;
  const rating = document.getElementById('rating').value;
  const sort = document.getElementById('sort-select').value;

  let query = '?';

  if (category) query += `category=${category}&`;
  if (minPrice) query += `minPrice=${minPrice}&`;
  if (maxPrice) query += `maxPrice=${maxPrice}&`;
  if (rating) query += `rating=${rating}&`;
  if (sort) query += `sort=${sort}&`;

  
  query = query.slice(-1) === '&' ? query.slice(0, -1) : query;

  window.location.href = `/shop${query}`;
}

		</script>



		<script>
			document.getElementById('min-price').addEventListener('input', validatePrices);
document.getElementById('max-price').addEventListener('input', validatePrices);

function validatePrices() {
    const minPrice = parseFloat(document.getElementById('min-price').value);
    const maxPrice = parseFloat(document.getElementById('max-price').value);

    // Clear any previous error messages
    document.getElementById('min-price-error').textContent = '';
    document.getElementById('max-price-error').textContent = '';

    // Prevent negative values
    if (minPrice < 0) {
        document.getElementById('min-price').value = '';
        document.getElementById('min-price-error').textContent = 'Min price cannot be negative.';
    }

    if (maxPrice < 0) {
        document.getElementById('max-price').value = '';
        document.getElementById('max-price-error').textContent = 'Max price cannot be negative.';
    }

    // Ensure max-price is greater than min-price
    if (minPrice >= maxPrice && maxPrice !== 0) {
        document.getElementById('max-price-error').textContent = 'Max price must be greater than Min price.';
    }
}


		</script>




	